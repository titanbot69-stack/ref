{% extends 'base.html' %}
{% load static %}
{% block title %}Application Owner Dashboard{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<h2 class="mb-3">Application Owner Dashboard</h2>
<ul class="nav nav-tabs" role="tablist">
	<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#application-requests" type="button">Application Requests</button></li>
</ul>
<div class="tab-content p-3 border border-top-0 card-like">
	<div class="tab-pane fade show active" id="application-requests">
		<div class="modern-search-box"><i class="fas fa-search"></i><input type="text" data-table-id="app-owner-requests-table-container" placeholder="Search..."></div>
		<div id="app-owner-requests-table-container">{% include 'partials/ra_application_owner_request.html' %}</div>
	</div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<style>
.modern-search-box{position:relative;margin-bottom:10px;width:300px;float:right;}
.modern-search-box input{width:100%;padding:8px 30px;border:1px solid #ddd;border-radius:20px;box-shadow:0 2px 4px rgba(0,0,0,.1);font-size:14px;transition:all .3s ease;}
.modern-search-box input:focus{border-color:#ff512f;box-shadow:0 4px 8px rgba(0,0,0,.15);outline:none;}
.modern-search-box i{position:absolute;top:50%;left:10px;transform:translateY(-50%);font-size:16px;color:#aaa;}
</style>
<script>
function getCookie(name){let v=null;if(document.cookie&&document.cookie!==''){const cs=document.cookie.split(';');for(let i=0;i<cs.length;i++){const c=cs[i].trim();if(c.substring(0,name.length+1)===(name+'=')){v=decodeURIComponent(c.substring(name.length+1));break;}}}return v;}

// Local search (delegated because partial already ships JS, but we consolidate here for future DRY)
document.addEventListener('DOMContentLoaded',function(){document.querySelectorAll('.modern-search-box input').forEach(inp=>{inp.addEventListener('input',function(){const id=this.getAttribute('data-table-id');const container=document.getElementById(id);if(!container)return;const items=container.querySelectorAll('.request-item');const f=this.value.toLowerCase();items.forEach(it=>{const search=it.getAttribute('data-searchable')?.toLowerCase()||'';it.style.display=search.includes(f)?'':'none';});});});});

// Action handling (delegated alternative to partial duplication)
document.addEventListener('click',function(e){const btn=e.target.closest('.btn-app-owner-action');if(!btn)return;const item=btn.closest('.request-item');const eventId=item?.dataset.eventId;const action=btn.dataset.appOwnerAction||btn.getAttribute('data-app-owner-action');if(!eventId||!action)return;fetch('/update_application_request_status/',{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':getCookie('csrftoken')},body:JSON.stringify({event_id:eventId,action})}).then(r=>r.json()).then(d=>{if(d.success){item.style.transition='opacity .5s';item.style.opacity=0;setTimeout(()=>item.remove(),500);}else alert('Failed: '+(d.error||'Unknown'));}).catch(()=>alert('Network error'));});
</script>
{% endblock %}
