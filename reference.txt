    # Determine initiator designation (allow CTO/CISO to initiate even if not RA)
    initiator_email = (request.user.email or '').lower()
    hrms_rows_all = get_hrms_list()
    initiator_row = next((r for r in hrms_rows_all if (r.get('business_email') or '').lower() == initiator_email), None)
    initiator_designation = (initiator_row or {}).get('external_designation', '')

    if not (
        initiator_email == (hrms_row.get('ra_email') or '').lower() or
        initiator_designation in ['Chief Technology Officer', 'Chief Information Security Officer']
    ):





            # Determine initial routing based on initiator role & request type
            is_grant = bool(new_state)
            if initiator_designation == 'Chief Technology Officer':
                # CTO initiates: Grant -> CISO first, Revoke -> Application Owner directly
                initial_assigned = 'CISO_APPROVAL' if is_grant else 'Application Owner'
            elif initiator_designation == 'Chief Information Security Officer':
                # CISO initiates: always route to CTO first (both grant & revoke), then skip CISO stage later
                initial_assigned = 'CTO_APPROVAL'
            else:
                # Regular RA initiates: standard path via CTO first
                initial_assigned = 'CTO_APPROVAL'






                        # Decide whether to skip CISO based on original requester (if CISO initiated)
                        trig_row = next((r for r in hrms_rows if (r.get('business_email') or '').lower() == (original_triggered_by or '').lower()), None)
                        trig_design = (trig_row or {}).get('external_designation', '')
                        if trig_design == 'Chief Information Security Officer':
                            next_assigned_to = 'Application Owner'
                        else:




                    elif current_assigned_to == 'CISO_APPROVAL':
                        # Edge case: if somehow revoke hit CISO (should not), send to Application Owner
                        next_assigned_to = 'Application Owner'
                        new_status = 'open'
