<h3>Certification Cycle Request</h3>
<p>Dear CTO,</p>
<p>The CISO ({{ requested_by }}) is requesting initiation of a new access certification cycle as of {{ ts }}.</p>
<p>Please review recent activity and, if appropriate, initiate the certification process. This request will be blocked if a cycle was initiated within the last 15 days.</p>
<p><strong>Reason (optional):</strong> {{ reason|default:"Not provided" }}</p>
<p>Regards,<br/>IAM Automation Service</p>



            WHERE (event_type = 'CERTIFICATION_INITIATED' OR event_type = 'CERTIFICATION_REQUESTED')


            msg = 'Certification already initiated or requested within last 15 days.'

                return JsonResponse({'ok': False, 'error': msg}, status=400)


    # Prepare and (optionally) send email to CTO
    cto_row = next((r for r in get_hrms_list() if (r.get('external_designation') or '') == 'Chief Technology Officer'), None)
    cto_email = (cto_row or {}).get('business_email') or 'cto@example.com'
    html = render(request, 'emails/request_certification.html', {
        'requested_by': request.user.email,
        'ts': timezone.now(),
        'reason': request.GET.get('reason') or request.POST.get('reason') or ''
    }).content.decode('utf-8')
    # _send_email('Certification Cycle Request', [cto_email], html)
    print(f'Request Certification email (simulated) to {cto_email}')
